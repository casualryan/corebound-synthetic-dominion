<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Idle Combat Game</title>
    <link rel="stylesheet" href="style.css">
    <!-- Add Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Sidebar Navigation -->
    <div id="sidebar">
        <div class="sidebar-section">
            <h2>Menu</h2>
            <ul class="sidebar-menu">
                <li data-screen="inventory-screen">
                    <img src="icons/inventory-icon.png" alt="Inventory Icon">
                    <span>Inventory</span>
                </li>
                <li data-screen="equipment-screen">
                    <img src="icons/equipment-icon.png" alt="Equipment Icon">
                    <span>Equipment</span>
                </li>
                <li data-screen="passives-screen">
                    <img src="icons/passives-icon.png" alt="Passives Icon">
                    <span>Passives</span>
            </ul>
        </div>
        <hr>

        <!-- Shops Section -->
        <div class="sidebar-section">
            <ul class="sidebar-menu">
                <li data-screen="shops-screen">
                    <img src="icons/shops-icon.png" alt="Shops Icon">
                    <span>Shops</span>
                </li>
            </ul>
        </div>
        <hr>

        <div class="sidebar-section">
            <ul class="sidebar-menu">
                <li data-screen="adventure-screen">
                    <img src="icons/adventure-icon.png" alt="Delve Icon">
                    <span>Delve</span>
                </li>
            </ul>
        </div>
        <hr>
        <div class="sidebar-section">
            <ul class="sidebar-menu">
                <li data-skill="Mining">
                    <img src="icons/mining-icon.png" alt="Mining Icon">
                    <span>Mining</span>
                </li>
                <li data-skill="Fabrication">
                    <img src="icons/fabricating-icon.png" alt="Fabricating Icon">
                    <span>Fabrication</span>
                </li>
                <li data-skill="Medtek">
                    <img src="icons/medtek-icon.png" alt="Medtek Icon">
                    <span>Medtek</span>
                </li>
                <!-- Add more non-combat skills as needed -->
            </ul>
        </div>
        <hr>
        <!-- Codex Section -->
        <div class="sidebar-section">
            <ul class="sidebar-menu">
                <li data-screen="codex-screen">
                    <img src="icons/codex-icon.png" alt="Codex Icon">
                    <span>Codex</span>
                </li>
            </ul>
        </div>
        <!-- Spacer to push settings button to the bottom -->
        <div class="sidebar-spacer"></div>
        <div class="sidebar-bottom">
            <button id="settings-button">
                <img src="icons/settings-icon.png" alt="Settings Icon">
                <span>Settings</span>
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div id="main-content">
        <!-- Inventory Screen -->
        <div id="inventory-screen" class="screen active">
            <h2>Inventory</h2>
            <ul id="inventory"></ul>
        </div>

        <!-- Equipment Screen -->
        <div id="equipment-screen" class="screen">
            <h2>Equipment</h2>
            <div id="equipment-paper-doll">
                <!-- Paper-doll layout -->
                <div id="head-slot" class="equipment-slot" data-slot="head">Head</div>
                <div id="chest-slot" class="equipment-slot" data-slot="chest">Chest</div>
                <div id="legs-slot" class="equipment-slot" data-slot="legs">Legs</div>
                <div id="feet-slot" class="equipment-slot" data-slot="feet">Feet</div>
                <div id="mainHand-slot" class="equipment-slot" data-slot="mainHand">MainHand</div>
                <div id="offHand-slot" class="equipment-slot" data-slot="offHand">OffHand</div>
                <div id="gloves-slot" class="equipment-slot" data-slot="gloves">Gloves</div>
                <!-- Bionic Slots -->
                <div id="bionic-slot-0" class="bionic-slot equipment-slot" data-slot="bionic-slot-0">Bionic 1</div>
                <div id="bionic-slot-1" class="bionic-slot equipment-slot" data-slot="bionic-slot-1">Bionic 2</div>
                <div id="bionic-slot-2" class="bionic-slot equipment-slot" data-slot="bionic-slot-2">Bionic 3</div>
                <div id="bionic-slot-3" class="bionic-slot equipment-slot" data-slot="bionic-slot-3">Bionic 4</div>
            </div>
        </div>

        <!-- Just after the equipment-screen or somewhere convenient -->
        <div id="passives-screen" class="screen">
            <h2>Passives</h2>
            
            <p>Passive Points: <span id="player-passive-points">0</span></p>
            <!-- Container for your tiers/passives -->
            <div id="passive-tiers"></div>
        </div>


        <!-- Shops Screen -->
        <div id="shops-screen" class="screen">
            <h2>Shops</h2>
            <!-- Display the NPC list here -->
            <div id="npc-list"></div>

            <!-- Display the selected NPC's shop here -->
            <div id="npc-shop-container"></div>
        </div>

        <!-- Adventure Screen -->
        <div id="adventure-screen" class="screen">
            <h2>Delve</h2>
            <div id="delve-controls"></div>
            <h3>Delve Locations</h3>
            <div id="adventure-locations"></div>
            <div class="container">
                <!-- Player Stats -->
                <div class="stats" id="player-stats">
                    <h2>Player Stats</h2>
                    <p>Name: <span id="player-name">Player</span></p>
                    <p>Level: <span id="player-level">1</span></p>
                    <p>Experience: <span id="player-experience">0</span></p>

                    <!-- Player HP Bar Container -->
                    <div class="hp-bar-container">
                        <div id="player-hp-bar" class="hp-bar"></div>
                    </div>
                    <div class="hp-text" id="player-hp-text">0 / 0</div>

                    <!-- Player Energy Shield Bar Container -->
                    <div class="es-bar-container">
                        <div id="player-es-bar" class="es-bar"></div>
                    </div>
                    <div class="es-text" id="player-es-text">0 / 0</div>

                    <!-- Attack Progress Bar -->
                    <h3>Attack Progress</h3>
                    <div class="progress-container">
                        <div id="player-attack-progress-bar" class="progress-bar attack-bar"></div>
                    </div>

                    <p>Attack Speed: <span id="player-attack-speed">0</span></p>
                    <p>Critical Chance: <span id="player-crit-chance">0%</span></p>
                    <p>Critical Multiplier: <span id="player-crit-multiplier">0</span></p>
                    <h3>Damage Types</h3>
                    <ul id="player-damage-types" class="stat-list"></ul>
                    <h3>Defense Types</h3>
                    <ul id="player-defense-types" class="stat-list"></ul>
                    <h3>Other Stats</h3>
                    <div>Precision: <span id="player-precision"></span></div>
                    <div>Deflection: <span id="player-deflection"></span></div>
                    <div>Health Regeneration: <span id="player-health-regen"></span> / Second</div>
                    <div id="player-damage-type-modifiers" style="list-style-type: none;"></div>
                    <h3>Active Effects</h3>
                    <ul id="player-active-effects" class="stat-list"></ul>
                </div>
                <!-- Enemy Stats -->
                <div class="stats" id="enemy-stats">
                    <h2>Enemy Stats</h2>
                    <p>Name: <span id="enemy-name">Unknown</span></p>
                    <div id="next-enemy-timer" style="display: none;">
                        Next enemy in <span id="next-enemy-countdown">2</span> seconds...
                    </div>

                    <!-- Enemy HP Bar Container -->
                    <div class="hp-bar-container">
                        <div id="enemy-hp-bar" class="hp-bar"></div>
                    </div>
                    <div class="hp-text" id="enemy-hp-text">0 / 0</div>

                    <!-- Enemy Energy Shield Bar Container -->
                    <div class="es-bar-container">
                        <div id="enemy-es-bar" class="es-bar"></div>
                    </div>
                    <div class="es-text" id="enemy-es-text">0 / 0</div>

                    <!-- Attack Progress Bar -->
                    <h3>Attack Progress</h3>
                    <div class="progress-container">
                        <div id="enemy-attack-progress-bar" class="progress-bar attack-bar"></div>
                    </div>
                    <p>Attack Speed: <span id="enemy-attack-speed">0</span></p>
                    <p>Critical Chance: <span id="enemy-crit-chance">0%</span></p>
                    <p>Critical Multiplier: <span id="enemy-crit-multiplier">0</span></p>
                    <h3>Damage Types</h3>
                    <ul id="enemy-damage-types" class="stat-list"></ul>
                    <h3>Defense Types</h3>
                    <ul id="enemy-defense-types" class="stat-list"></ul>
                    <h3>Active Effects</h3>
                    <ul id="enemy-active-effects" class="stat-list"></ul>
                </div>
                <!-- Combat Log -->
                <div class="combat-log">
                    <h2>Combat Log</h2>
                    <div id="log-messages"></div>
                </div>
            </div>
        </div>

        <!-- Codex Screen -->
        <div id="codex-screen" class="screen">
            <h2>Codex</h2>
            <!-- Area Tabs -->
            <div id="codex-area-tabs" class="area-tabs">
                <!-- Tabs will be dynamically populated -->
            </div>
            <!-- Enemy List -->
            <div id="codex-enemy-list">
                <!-- Enemy details will be dynamically populated -->
            </div>
        </div>

        <!-- Mining Screen -->
        <div id="mining-screen" class="screen">
            <h2>Mining</h2>
            <div id="mining-activities" class="activities"></div>
            <h3>Progress</h3>
            <div class="progress-container">
                <div id="mining-progress-bar" class="progress-bar gathering-bar"></div>
            </div>
            <button id="stop-mining" style="display: none;">Stop Mining</button>
            <div id="gathering-skill-stats"></div>
        </div>

        <!-- fabrication-screen -->
        <div id="fabrication-screen" class="screen">
            <h2>Fabrication</h2>
            <div id="fabrication-categories">
                <!-- Categories will be dynamically populated -->
            </div>
            <div id="recipe-container" class="recipe-container">
                <!-- Recipes will be dynamically populated -->
            </div>
        </div>

        <!-- Medtek Screen -->
        <div id="medtek-screen" class="screen">
            <h2>Medtek</h2>
            <div class="activities"></div>
            <h3>Progress</h3>
            <div class="progress-container">
                <div id="medtek-progress-bar" class="progress-bar gathering-bar"></div>
            </div>
            <button id="stop-medtek" style="display: none;">Stop Crafting</button>
            <div id="medtek-skill-stats"></div>
        </div>
    </div>

    <!-- Settings Menu (Modal) -->
    <div id="settings-menu" class="modal">
        <div class="modal-content">
            <span id="close-settings" class="close-button">&times;</span>
            <h2>Settings</h2>
            <div class="settings-buttons">
                <button id="save-game">Save Game</button>
                <button id="load-game">Load Game</button>
                <button id="reset-game">Reset Save</button>
            </div>
        </div>
    </div>

    <script src="items.js"></script>
    <script src="recipes.js"></script>
    <script src="enemies.js"></script>
    <script src="injectors.js"></script>
    <script src="skills.js"></script>
    <script src="passives.js"></script>
    <script src="gathering_activities.js"></script>
    <script src="tooltip.js"></script>
    <script src="global.js"></script>
    <script src="inventory.js"></script>
    <script src="gathering.js"></script>
    <script src="fabrication.js"></script>
    <script src="npcshops.js"></script>
    <script src="buffs.js"></script>
    <script src="itemgenerator.js"></script>
    <script src="passivesUI.js"></script>
    <script src="sounds.js"></script>
    <script src="statusEffects.js"></script>
    <script src="locations.js"></script>
    <script src="disassemble.js"></script>
    <script src="lootPools.js"></script>
    <script src="lootHandler.js"></script>
    <script src="combat.js"></script>

    <!-- Popups -->
    <div id="damage-popups-container"></div>
    <div id="loot-popups-container"></div>

    <!-- Codex Script -->
    <script>
        // Codex functionality from original code or your code can remain unchanged.
        document.addEventListener('DOMContentLoaded', function () {
            const areaTabsContainer = document.getElementById('codex-area-tabs');
            const enemyListContainer = document.getElementById('codex-enemy-list');

            function populateAreaTabs() {
                locations.forEach(location => {
                    const tab = document.createElement('button');
                    tab.classList.add('codex-area-tab');
                    tab.textContent = location.name;
                    tab.style.padding = '10px';
                    tab.style.margin = '5px';
                    tab.style.borderRadius = '5px';
                    tab.style.border = '1px solid #00ffcc';
                    tab.style.background = 'rgba(0,0,0,0.5)';
                    tab.style.color = '#fff';
                    tab.style.cursor = 'pointer';
                    tab.addEventListener('mouseover', () => {
                        tab.style.background = 'rgba(0,255,204,0.2)';
                    });
                    tab.addEventListener('mouseout', () => {
                        tab.style.background = 'rgba(0,0,0,0.5)';
                    });
                    tab.addEventListener('click', () => {
                        displayEnemiesForLocation(location);
                    });
                    areaTabsContainer.appendChild(tab);
                });
            }

            function displayEnemiesForLocation(location) {
                enemyListContainer.innerHTML = '';
                const locationHeader = document.createElement('h3');
                locationHeader.textContent = location.name;
                enemyListContainer.appendChild(locationHeader);

                location.enemies.forEach(locationEnemy => {
                    const enemyData = enemies.find(e => e.name === locationEnemy.name);
                    if (enemyData) {
                        const enemyContainer = document.createElement('div');
                        enemyContainer.classList.add('codex-enemy');
                        enemyContainer.style.border = '1px solid #333';
                        enemyContainer.style.padding = '10px';
                        enemyContainer.style.margin = '10px 0';
                        enemyContainer.style.borderRadius = '5px';
                        enemyContainer.style.background = 'rgba(0,0,0,0.5)';

                        const enemyName = document.createElement('h4');
                        enemyName.textContent = `${enemyData.name} (Spawn Rate: ${locationEnemy.spawnRate}%)`;
                        enemyContainer.appendChild(enemyName);

                        const statsList = document.createElement('ul');
                        statsList.classList.add('codex-enemy-stats');
                        statsList.style.listStyle = 'none';
                        statsList.style.padding = '0';

                        const healthItem = document.createElement('li');
                        healthItem.textContent = `Health: ${enemyData.health}`;
                        statsList.appendChild(healthItem);

                        const shieldItem = document.createElement('li');
                        shieldItem.textContent = `Energy Shield: ${enemyData.energyShield}`;
                        statsList.appendChild(shieldItem);

                        const attackSpeedItem = document.createElement('li');
                        attackSpeedItem.textContent = `Attack Speed: ${enemyData.attackSpeed}`;
                        statsList.appendChild(attackSpeedItem);

                        const critChanceItem = document.createElement('li');
                        critChanceItem.textContent = `Critical Chance: ${(enemyData.criticalChance * 100).toFixed(2)}%`;
                        statsList.appendChild(critChanceItem);

                        const critMultiplierItem = document.createElement('li');
                        critMultiplierItem.textContent = `Critical Multiplier: ${enemyData.criticalMultiplier}`;
                        statsList.appendChild(critMultiplierItem);

                        const damageTypes = Object.entries(enemyData.damageTypes).map(([type, value]) => `${type.charAt(0).toUpperCase()+type.slice(1)}: ${value}`).join(', ');
                        const damageTypesItem = document.createElement('li');
                        damageTypesItem.textContent = `Damage Types: ${damageTypes}`;
                        statsList.appendChild(damageTypesItem);

                        if (enemyData.defenseTypes && Object.keys(enemyData.defenseTypes).length > 0) {
                            const defenseTypes = Object.entries(enemyData.defenseTypes).map(([type, value]) => `${type.charAt(0).toUpperCase()+type.slice(1)}: ${value}`).join(', ');
                            const defenseTypesItem = document.createElement('li');
                            defenseTypesItem.textContent = `Defense Types: ${defenseTypes}`;
                            statsList.appendChild(defenseTypesItem);
                        }

                        enemyContainer.appendChild(statsList);

                        // Display loot information from the new loot system
                        if (enemyData.lootConfig) {
                            const lootHeader = document.createElement('h5');
                            lootHeader.textContent = 'Loot Information:';
                            enemyContainer.appendChild(lootHeader);

                            const lootList = document.createElement('ul');
                            lootList.classList.add('codex-enemy-loot');
                            lootList.style.listStyle = 'none';
                            lootList.style.padding = '0';

                            // Base drop chance
                            const dropChanceItem = document.createElement('li');
                            const dropChance = (enemyData.lootConfig.baseDropChance * 100).toFixed(2);
                            dropChanceItem.textContent = `Base Drop Chance: ${dropChance}%`;
                            lootList.appendChild(dropChanceItem);

                            // Number of items
                            const itemCountItem = document.createElement('li');
                            itemCountItem.textContent = `Items Per Drop: ${enemyData.lootConfig.minItems} - ${enemyData.lootConfig.maxItems}`;
                            lootList.appendChild(itemCountItem);

                            // Loot pools by tier
                            const poolsItem = document.createElement('li');
                            poolsItem.textContent = "Available Loot Pools:";
                            lootList.appendChild(poolsItem);

                            // Add sublist for pools
                            const poolsList = document.createElement('ul');
                            poolsList.style.paddingLeft = '20px';

                            for (const tier in enemyData.lootConfig.poolsByTier) {
                                const tierItem = document.createElement('li');
                                const pools = enemyData.lootConfig.poolsByTier[tier].join(', ');
                                let tierName = "Unknown";
                                
                                // Map tier numbers to names
                                switch (parseInt(tier)) {
                                    case 1: tierName = "Common"; break;
                                    case 2: tierName = "Uncommon"; break;
                                    case 3: tierName = "Rare"; break;
                                    case 4: tierName = "Very Rare"; break;
                                    case 5: tierName = "Epic"; break;
                                    case 6: tierName = "Legendary"; break;
                                }
                                
                                tierItem.textContent = `Tier ${tier} (${tierName}): ${pools}`;
                                poolsList.appendChild(tierItem);
                            }
                            
                            lootList.appendChild(poolsList);
                            enemyContainer.appendChild(lootList);
                        }
                        // Display the old loot table if it exists and there's no loot config
                        // This is just for backward compatibility during transition
                        else if (enemyData.lootTable && enemyData.lootTable.length > 0) {
                            const lootHeader = document.createElement('h5');
                            lootHeader.textContent = 'Legacy Loot Table:';
                            enemyContainer.appendChild(lootHeader);

                            const lootList = document.createElement('ul');
                            lootList.classList.add('codex-enemy-loot');
                            lootList.style.listStyle = 'none';
                            lootList.style.padding = '0';

                            enemyData.lootTable.forEach(lootItem => {
                                const lootListItem = document.createElement('li');
                                const dropRate = (lootItem.dropRate * 100).toFixed(2);
                                lootListItem.textContent = `${lootItem.itemName} (Drop Rate: ${dropRate}%, Quantity: ${lootItem.minQuantity}-${lootItem.maxQuantity})`;
                                lootList.appendChild(lootListItem);
                            });

                            enemyContainer.appendChild(lootList);
                        }

                        enemyListContainer.appendChild(enemyContainer);
                    } else {
                        const missingEnemy = document.createElement('div');
                        missingEnemy.textContent = `Enemy data not found for ${locationEnemy.name}`;
                        enemyListContainer.appendChild(missingEnemy);
                    }
                });
            }

            populateAreaTabs();
            if (locations.length > 0) {
                displayEnemiesForLocation(locations[0]);
            }
        });
    </script>

</body>
</html>
